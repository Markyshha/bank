<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeoBank ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ñ–µ–π–∫-–±–∞–Ω–∫</title>

  <!-- QR library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

  <style>
    /*
      NeoBank ‚Äî single-file SPA (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
      –ò–∑–º–µ–Ω–µ–Ω–∏—è:
      1) –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ (email, —Ç–µ–ª–µ—Ñ–æ–Ω, –§–ò–û)
      2) –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è ID –∏ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã
      3) –ü–æ–ª–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã
      4) –ú–∞–≥–∞–∑–∏–Ω –±–∞–ª–ª–æ–≤ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–≤–µ—Ä–ª–µ–µ –ø–æ–≤–µ—Ä—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      5) –í–∫–ª–∞–¥–∫–∏ Pay/Points/Topup/History/Profile ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–µ–ø–µ—Ä—å –∫–∞–∫ –æ–≤–µ—Ä–ª–µ–∏
    */

    /* ===== CSS VARIABLES / THEMING ===== */
    :root {
      --bg: #0b0c10;
      --panel: #12141a;
      --text: #e7eaf1;
      --muted: #9aa3b2;
      --primary: #7c5cff;
      --primary-2: #00d4ff;
      --accent: #232632;
      --ok: #1fd67a;
      --warn: #ffb020;
      --err: #ff5c5c;
      --shadow: 0 10px 24px rgba(0,0,0,.25), 0 6px 10px rgba(0,0,0,.15);
      --radius: 18px;
      --trans: .22s cubic-bezier(.2,.7,.2,1);
    }

    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    .theme-light {
      --bg: #f7f8fb;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #5b6475;
      --primary: #6b5cff;
      --primary-2: #2bd3ff;
      --accent: #eef2f7;
      --shadow: 0 10px 24px rgba(17,24,39,.08), 0 6px 10px rgba(17,24,39,.06);
    }
    /* –ó–µ–ª—ë–Ω–∞—è —Ç–µ–º–∞ */
    .theme-green { --primary: #12cc7b; --primary-2: #50e3a4; --accent: #0f2c24; }
    /* –§–∏–æ–ª–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞ */
    .theme-purple { --primary: #8d5cff; --primary-2: #ff6bd6; --accent: #23142e; }

    /* ===== BASE ===== */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Inter, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background var(--trans), color var(--trans);
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px clamp(16px, 3vw, 28px);
      display: grid;
      gap: 22px;
    }

    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, var(--primary), var(--primary-2)); box-shadow: var(--shadow); }
    h1 { font-size: clamp(20px, 2.4vw, 28px); margin: 0; letter-spacing: .2px; }

    .header-actions { display: flex; gap: 10px; align-items: center; }
    .theme-select, .btn {
      border: 0; outline: 0; border-radius: 12px;
      padding: 10px 14px; background: var(--panel); color: var(--text);
      box-shadow: var(--shadow);
      transition: transform var(--trans), background var(--trans), opacity var(--trans), box-shadow var(--trans);
    }
    .btn:hover, .theme-select:hover { transform: translateY(-2px); }
    .btn:active { transform: translateY(0); opacity: .9; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-2)); color: #0b0c10; font-weight: 800; }
    .btn-ghost { background: var(--accent); }

    /* ===== SUMMARY ===== */
    .summary { display: grid; grid-template-columns: 1.4fr .8fr; gap: 22px; }
    @media (max-width: 900px) { .summary { grid-template-columns: 1fr; } }

    /* ===== NEW CARD DESIGN (full redesign) ===== */
    .bank-card {
      position: relative; overflow: hidden; border-radius: 22px; padding: 24px 22px; min-height: 230px;
      color: #eaf0ff; display: grid; align-content: space-between; box-shadow: var(--shadow); isolation: isolate;
      background: linear-gradient(160deg, #0f1117 0%, #171a23 60%, #0f1117 100%);
      border: 1px solid rgba(255,255,255,.06);
    }
    /* –Ω–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ */
    .bank-card::before {
      content: ""; position: absolute; inset: -2px; border-radius: 24px; padding: 1.2px;
      background: conic-gradient(from 120deg, var(--primary), var(--primary-2), var(--primary));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; z-index: -1;
    }
    /* –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω */
    .bank-card::after {
      content: ""; position: absolute; width: 280px; height: 280px; right: -60px; top: -60px; border-radius: 50%;
      background: radial-gradient(closest-side, rgba(124,92,255,.35), rgba(43,211,255,.15) 60%, transparent 70%);
      filter: blur(8px); opacity: .8; z-index: 0;
    }
    .card-top { display: flex; justify-content: space-between; align-items: start; z-index: 1; }
    .chip { width: 46px; height: 34px; border-radius: 8px; background: linear-gradient(180deg,#d4d4d4,#9f9f9f); box-shadow: inset 0 1px 0 rgba(255,255,255,.6), inset 0 -1px 0 rgba(0,0,0,.25); }
    .holo { width: 42px; height: 42px; border-radius: 50%; background: conic-gradient(from 45deg, #ff7ee7, #7df, #8eff7a, #ff7ee7); filter: saturate(1.2) blur(.2px); opacity: .9; mix-blend-mode: screen; }
    .card-badge { font-size: 12px; letter-spacing: .12em; text-transform: uppercase; opacity: .9; background: rgba(255,255,255,.06); padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.08); }

    .card-number { font-size: clamp(20px, 2.8vw, 26px); letter-spacing: 2.4px; font-weight: 800; text-shadow: 0 1px 0 rgba(255,255,255,.06); z-index: 1; }
    .card-meta { display: flex; gap: 18px; opacity: .9; font-size: 14px; align-items: center; }
    .meta-row { display: flex; justify-content: space-between; align-items: end; gap: 14px; z-index: 1; }
    .owner { font-weight: 700; letter-spacing: .8px; }
    .valid { color: #b9c2d3; }

    /* ===== QUICK STATS ===== */
    .quick-stats { background: var(--panel); border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); display: grid; gap: 14px; align-content: start; }
    .stat { display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.03)); border-radius: 14px; border: 1px solid rgba(255,255,255,.04); }
    .stat .label { color: var(--muted); font-size: 14px; }
    .stat .value { font-weight: 700; }

    /* ===== NAV CARDS ===== */
    .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 14px; }
    @media (max-width: 900px) { .nav-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 540px) { .nav-grid { grid-template-columns: repeat(2, 1fr); } }

    .nav-card { cursor: pointer; padding: 18px; border-radius: 16px; background: var(--panel); box-shadow: var(--shadow);
      display: grid; gap: 8px; align-content: center; justify-items: start; min-height: 94px; position: relative;
      overflow: hidden; transition: transform var(--trans), background var(--trans), box-shadow var(--trans);
    }
    .nav-card:hover { transform: translateY(-4px); }
    .nav-icon { width: 28px; height: 28px; opacity: .95; }
    .nav-title { font-weight: 700; }

    /* ===== PAGES ===== */
    .page { display: none; }
    .page.active { display: grid; gap: 18px; }

    .panel { background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; }

    form .row { display: grid; gap: 10px; margin-bottom: 12px; }
    input[type="number"], input[type="text"], input[type="email"], input[type="tel"], select {
      width: 100%; border: 1px solid rgba(255,255,255,.08); background: var(--accent); color: var(--text);
      border-radius: 12px; padding: 12px 14px; font-size: 16px; outline: none; transition: border var(--trans), box-shadow var(--trans);
    }
    input::placeholder { color: var(--muted); }
    input:focus, select:focus { border-color: var(--primary-2); box-shadow: 0 0 0 3px rgba(0,212,255,.15); }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; }

    /* History table */
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { text-align: left; padding: 12px 10px; border-bottom: 1px dashed rgba(255,255,255,.08); }
    .table th { color: var(--muted); font-weight: 600; }

    /* Shop */
    .shop-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }
    @media (max-width: 1024px){ .shop-grid { grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 760px){ .shop-grid { grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 480px){ .shop-grid { grid-template-columns: 1fr; } }
    .product { background: var(--panel); border-radius: 16px; box-shadow: var(--shadow); overflow: hidden; display: grid; gap: 10px; padding: 14px; transition: transform var(--trans); }
    .product:hover { transform: translateY(-3px); }
    .product .thumb { height: 120px; border-radius: 12px; background: linear-gradient(135deg, #222, var(--accent)); display: grid; place-items: center; font-weight: 800; opacity: .9; }
    .product .meta { display: flex; justify-content: space-between; align-items: center; }

    /* ===== MODAL / OVERLAY (–æ–Ω–±–æ—Ä–¥–∏–Ω–≥ + –º–∞–≥–∞–∑–∏–Ω + —Å—Ç—Ä–∞–Ω–∏—Ü—ã) ===== */
    .modal-overlay { position: fixed; inset: 0; backdrop-filter: blur(10px); background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; padding: 18px; z-index: 9998; }
    .modal-overlay.show { display: flex; }
    .modal-dialog { width: min(920px, 96vw); background: var(--panel); border-radius: 22px; box-shadow: var(--shadow); padding: 18px; position: relative; border: 1px solid rgba(255,255,255,.06); }
    .modal-dialog.lg { width: min(1100px, 98vw); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .modal-title { font-size: 20px; font-weight: 800; }
    .modal-close { border: 0; background: var(--accent); color: var(--text); border-radius: 10px; padding: 8px 10px; cursor: pointer; }

    /* Toasts */
    .toasts { position: fixed; right: 16px; bottom: 16px; display: grid; gap: 10px; z-index: 9999; }
    .toast { background: var(--panel); color: var(--text); border-left: 6px solid var(--ok); padding: 12px 14px; border-radius: 14px; box-shadow: var(--shadow); animation: slideIn .4s ease-out; }
    .toast.warn{ border-left-color: var(--warn); }
    .toast.err{ border-left-color: var(--err); }
    @keyframes slideIn { from { transform: translateY(12px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    footer { color: var(--muted); font-size: 13px; text-align: center; padding: 16px 0 32px; }

    /* ======================= –î–û–ë–ê–í–õ–ï–ù–û: –ü–ª–∞–≤–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –±–∞–ª–∞–Ω—Å–∞ ======================= */
    /* NEW: –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–≤–µ—Ä–ª–µ–µ–≤ —Å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ–º —Ñ–æ–Ω–∞ */
    .modal-overlay { /* –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã, –ª–æ–≥–∏–∫–∞ JS –Ω–µ —Ç—Ä–æ–Ω—É—Ç–∞ */
      display: flex;                 /* –¥–µ—Ä–∂–∏–º —Ñ–ª–µ–∫—Å-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ–≥–¥–∞, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ visibility/opacity */
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity var(--trans), visibility var(--trans);
    }
    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
    .modal-overlay .modal-dialog { /* NEW: –ª—ë–≥–∫–∏–π —Å–ª–∞–π–¥ –∏ fade —É –¥–∏–∞–ª–æ–≥–∞ */
      transform: translateY(12px);
      opacity: 0;
      transition: transform var(--trans), opacity var(--trans);
    }
    .modal-overlay.show .modal-dialog {
      transform: translateY(0);
      opacity: 1;
    }

    /* NEW: –∫—Ä–∞—Ç–∫–∞—è –∫—Ä–∞—Å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ */
    @keyframes nb-balance-flash-red {
      0% { color: var(--text); }
      20% { color: var(--err); }
      80% { color: var(--err); }
      100% { color: var(--text); }
    }
    .balance-flash-red { animation: nb-balance-flash-red 1.2s ease; }
    /* ======================= /–î–û–ë–ê–í–õ–ï–ù–û ======================= */
  </style>
</head>
<body>
  <div id="app" class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>NeoBank</h1>
      </div>
      <div class="header-actions">
        <select id="themeSelect" class="theme-select" aria-label="–°–º–µ–Ω–∞ —Ç–µ–º—ã">
          <option value="default">–¢–µ–º–∞: –¢—ë–º–Ω–∞—è</option>
          <option value="light">–¢–µ–º–∞: –°–≤–µ—Ç–ª–∞—è</option>
          <option value="green">–¢–µ–º–∞: –ó–µ–ª—ë–Ω–∞—è</option>
          <option value="purple">–¢–µ–º–∞: –§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
        </select>
        <button class="btn btn-ghost" data-route="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      </div>
    </header>

    <!-- SUMMARY: Card + quick stats -->
    <section class="summary">
      <article class="bank-card" aria-label="–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞">
        <div class="card-top">
          <div class="chip" aria-hidden="true"></div>
          <div class="card-badge">virtual ‚Ä¢ debit</div>
          <div class="holo" aria-hidden="true"></div>
        </div>
        <div class="card-number" id="cardNumber">5282  3421  9012  3456</div>
        <div class="meta-row">
          <div class="card-meta"><span class="owner" id="cardOwner">Neo User</span></div>
          <div class="card-meta"><span class="valid" id="validThru">VALID THRU 12/29</span> <span>NeoBank ‚Ä¢ World</span></div>
        </div>
      </article>

      <aside class="quick-stats">
        <div class="stat">
          <div>
            <div class="label">–ë–∞–ª–∞–Ω—Å</div>
            <div class="value" id="balanceView">0 ‚ÇΩ</div>
          </div>
          <button class="btn btn-primary" data-route="topup">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        </div>
        <div class="stat">
          <div>
            <div class="label">–ë–∞–ª–ª—ã</div>
            <div class="value" id="pointsView">0</div>
          </div>
          <div class="actions">
            <button class="btn btn-ghost" data-route="points">–£–ø—Ä–∞–≤–ª—è—Ç—å</button>
            <button class="btn btn-primary" data-route="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
          </div>
        </div>
      </aside>
    </section>

    <!-- NAVIGATION BLOCKS -->
    <nav class="nav-grid" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="nav-card" data-route="pay">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 7h18M3 10h18M7 15h1m3 0h6"/><rect x="3" y="5" width="18" height="14" rx="4"/></svg>
        <div class="nav-title">–û–ø–ª–∞—Ç–∏—Ç—å</div>
        <div class="nav-desc">–°–ø–∏—Å–∞—Ç—å —Å—É–º–º—É –∏ –Ω–∞—á–∏—Å–ª–∏—Ç—å 5% –±–∞–ª–ª–∞–º–∏</div>
      </div>
      <div class="nav-card" data-route="topup">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 19V5"/><path d="M5 12h14"/></svg>
        <div class="nav-title">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
        <div class="nav-desc">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</div>
      </div>
      <div class="nav-card" data-route="history">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><path d="M12 7v6l4 2"/></svg>
        <div class="nav-title">–ò—Å—Ç–æ—Ä–∏—è</div>
        <div class="nav-desc">–í—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
      </div>
      <div class="nav-card" data-route="shop">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 6h12l1 4H5l1-4Z"/><path d="M6 10v7a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-7"/></svg>
        <div class="nav-title">–ú–∞–≥–∞–∑–∏–Ω –±–∞–ª–ª–æ–≤</div>
        <div class="nav-desc">–û–±–º–µ–Ω—è–π –±–∞–ª–ª—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã</div>
      </div>
      <div class="nav-card" data-route="profile">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>
        <div class="nav-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="nav-desc">–î–∞–Ω–Ω—ã–µ, —Ç–µ–º—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      </div>
    </nav>

    <!-- PAGES (–∫–∞–∫ —Ä–∞–Ω—å—à–µ; –º–∞–≥–∞–∑–∏–Ω —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –æ–≤–µ—Ä–ª–µ–µ) -->
    <section id="page-pay" class="page panel" aria-labelledby="payTitle">
      <h2 id="payTitle">–û–ø–ª–∞—Ç–∞</h2>
      <form id="payForm">
        <div class="row">
          <label for="payAmount">–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã (‚ÇΩ)</label>
          <input id="payAmount" type="number" min="1" step="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1200" required />
        </div>
        <div class="actions">
          <button class="btn btn-primary" type="submit">–û–ø–ª–∞—Ç–∏—Ç—å</button>
          <button class="btn btn-ghost" type="reset">–°–±—Ä–æ—Å</button>
        </div>
        <p class="hint" style="color:var(--muted); margin:8px 0 0">–ó–∞ –∫–∞–∂–¥—É—é –æ–ø–ª–∞—Ç—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è <b>5%</b> –æ—Ç —Å—É–º–º—ã –≤ –±–∞–ª–ª–∞—Ö.</p>
      </form>
    </section>

    <section id="page-points" class="page panel" aria-labelledby="pointsTitle">
      <h2 id="pointsTitle">–ë–∞–ª–ª—ã</h2>
      <div class="row">
        <div>–¢–µ–∫—É—â–∏–µ –±–∞–ª–ª—ã: <b id="pointsView2">0</b></div>
      </div>
      <form id="exchangeForm">
        <div class="row">
          <label for="exchangeAmount">–û–±–º–µ–Ω—è—Ç—å –±–∞–ª–ª—ã –Ω–∞ –¥–µ–Ω—å–≥–∏</label>
          <input id="exchangeAmount" type="number" min="1" step="1" placeholder="–°–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –æ–±–º–µ–Ω—è—Ç—å" />
        </div>
        <div class="actions">
          <button class="btn btn-primary" type="submit">–û–±–º–µ–Ω—è—Ç—å</button>
          <button class="btn btn-ghost" type="button" id="exchangeAll">–û–±–º–µ–Ω—è—Ç—å –≤—Å—ë</button>
        </div>
        <p class="hint" style="color:var(--muted); margin:8px 0 0">–ö—É—Ä—Å: <b>1 –±–∞–ª–ª = 1 ‚ÇΩ</b>.</p>
      </form>
    </section>

    <section id="page-topup" class="page panel" aria-labelledby="topupTitle">
      <h2 id="topupTitle">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
      <form id="topupForm">
        <div class="row">
          <label for="topupAmount">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚ÇΩ)</label>
          <input id="topupAmount" type="number" min="1" step="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 3000" required />
        </div>
        <div class="actions">
          <button class="btn btn-primary" type="submit">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          <button class="btn btn-ghost" type="reset">–°–±—Ä–æ—Å</button>
        </div>
      </form>
    </section>

    <section id="page-history" class="page panel" aria-labelledby="historyTitle">
      <h2 id="historyTitle">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
      <div class="table-wrap">
        <table class="table" aria-describedby="historyTitle">
          <thead>
            <tr><th>–î–∞—Ç–∞</th><th>–û–ø–µ—Ä–∞—Ü–∏—è</th><th>–°—É–º–º–∞</th><th>–ë–∞–ª–ª—ã</th></tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>

    <!-- –°–µ–∫—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ –≤ —Ä–∞–∑–º–µ—Ç–∫–µ –æ—Å—Ç–∞—ë—Ç—Å—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏), –Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –º–æ–¥–∞–ª -->
    <section id="page-shop" class="page" aria-labelledby="shopTitle">
      <div class="panel">
        <h2 id="shopTitle">–ú–∞–≥–∞–∑–∏–Ω –±–∞–ª–ª–æ–≤</h2>
        <p style="color:var(--muted); margin-top:-4px">–û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –±–æ–Ω—É—Å—ã.</p>
      </div>
      <div class="shop-grid" id="shopGrid"></div>
    </section>

    <section id="page-profile" class="page panel" aria-labelledby="profileTitle">
      <h2 id="profileTitle">–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <form id="profileForm">
        <div class="row">
          <label for="userName">–ò–º—è</label>
          <input id="userName" type="text" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è" />
        </div>
        <div class="row">
          <label for="userId">ID</label>
          <input id="userId" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 100200" />
        </div>
        <div class="row">
          <label for="userCity">–ì–æ—Ä–æ–¥</label>
          <input id="userCity" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –£—Ñ–∞" />
        </div>
        <div class="row">
          <label for="themeSelect2">–¢–µ–º–∞</label>
          <select id="themeSelect2">
            <option value="default">–¢—ë–º–Ω–∞—è</option>
            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
            <option value="green">–ó–µ–ª—ë–Ω–∞—è</option>
            <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
          </select>
        </div>
        <div class="actions">
          <button class="btn btn-primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </section>

    <footer>‚ö†Ô∏è –≠—Ç–æ —É—á–µ–±–Ω—ã–π –º–∞–∫–µ—Ç ¬´—Ñ–µ–π–∫–æ–≤–æ–≥–æ¬ª –±–∞–Ω–∫–∞ NeoBank. –î–µ–Ω–µ–≥ –∑–¥–µ—Å—å –Ω–µ—Ç üôÇ</footer>
  </div>

  <!-- ===== –û–í–ï–†–õ–ï–ô: –ú–ê–ì–ê–ó–ò–ù –ë–ê–õ–õ–û–í ===== -->
  <div id="shopModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-dialog lg" role="dialog" aria-modal="true" aria-labelledby="shopModalTitle">
      <div class="modal-header">
        <div class="modal-title" id="shopModalTitle">–ú–∞–≥–∞–∑–∏–Ω –±–∞–ª–ª–æ–≤</div>
        <button class="modal-close" data-close-shop>–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <p style="color:var(--muted); margin: 0 0 12px">–û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ –±–∞–ª–ª—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã. –ü–æ–∫—É–ø–∫–∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç –±–∞–ª–ª—ã –Ω–∞–ø—Ä—è–º—É—é.</p>
      <div class="shop-grid" id="shopGridModal"></div>
    </div>
  </div>

  <!-- ===== –û–í–ï–†–õ–ï–ô: –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ü–†–ò –ü–ï–†–í–û–ú –û–¢–ö–†–´–¢–ò–ò ===== -->
  <div id="onboarding" class="modal-overlay" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="onboardTitle">
      <div class="modal-header">
        <div class="modal-title" id="onboardTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
      </div>
      <form id="onboardForm">
        <div class="row">
          <label for="fullName">–§–ò–û</label>
          <input id="fullName" type="text" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required />
        </div>
        <div class="row">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="name@example.com" required />
        </div>
        <div class="row">
          <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input id="phone" type="tel" placeholder="+7 900 000-00-00" required />
        </div>
        <div class="row">
          <label for="city">–ì–æ—Ä–æ–¥</label>
          <input id="city" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ú–æ—Å–∫–≤–∞" />
        </div>
        <div class="actions">
          <button class="btn btn-primary" type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
        <p class="hint" style="color:var(--muted); margin:8px 0 0">–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ <b>ID</b> –∏ <b>–Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</b>.</p>
      </form>
    </div>
  </div>

  <!-- ===== –û–í–ï–†–õ–ï–ô: –î–õ–Ø –°–¢–†–ê–ù–ò–¶ (Pay/Points/Topup/History/Profile) ===== -->
  <div id="pageOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" id="pageOverlayDialog">
      <div class="modal-header">
        <div class="modal-title" id="overlayTitle">–°—Ç—Ä–∞–Ω–∏—Ü–∞</div>
        <button class="modal-close" id="overlayClose">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div id="overlayBody"><!-- —Å—é–¥–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –Ω—É–∂–Ω—É—é .page --></div>
    </div>
  </div>

  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script>
    // ====== STATE ======
    const STORAGE_KEY = 'neobank_state_v1';
    const initialState = {
      user: { name: '', id: '', city: '', email: '', phone: '' },
      balance: 10000, // ‚ÇΩ
      points: 500,    // –±–∞–ª–ª—ã
      theme: 'default',
      validThru: '',
      history: [ { type: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', amount: 10000, points: 0, date: new Date().toISOString() } ],
      shop: [
        { id: 's1', title: 'Premium —Å—Ç–∏–∫–µ—Ä—ã', cost: 300, emoji: '‚ú®' },
        { id: 's2', title: '1 –º–µ—Å—è—Ü –ú—É–∑—ã–∫–∏', cost: 700, emoji: 'üéß' },
        { id: 's3', title: '–ö–æ—Ñ–µ –ª–∞—Ç—Ç–µ', cost: 120, emoji: '‚òï' },
        { id: 's4', title: '–ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫', cost: 900, emoji: 'üéÆ' },
        { id: 's5', title: '100 –ì–ë –æ–±–ª–∞–∫–∞', cost: 600, emoji: '‚òÅÔ∏è' },
        { id: 's6', title: '–ö—É–ø–æ–Ω —Ç–∞–∫—Å–∏', cost: 450, emoji: 'üöï' },
        { id: 's7', title: '–ú–µ—Å—è—Ü –ü—Ä–µ–º–∏—É–º', cost: 1200, emoji: 'üíé' },
        { id: 's8', title: '–ö—ç—à–±—ç–∫-–±—É—Å—Ç', cost: 800, emoji: 'üí•' },
      ]
    };

    const loadState = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || initialState; } catch { return initialState; }
    };
    const saveState = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    let state = loadState();

    // ====== HELPERS ======
    const fmtMoney = (n) => new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', maximumFractionDigits: 0 }).format(n);
    const fmtDate = (iso) => new Intl.DateTimeFormat('ru-RU', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).format(new Date(iso));

    function toast(msg, type = 'ok') {
      const t = document.createElement('div');
      t.className = 'toast' + (type === 'warn' ? ' warn' : type === 'err' ? ' err' : '');
      t.textContent = msg;
      document.getElementById('toasts').appendChild(t);
      setTimeout(() => { t.style.transition = 'opacity .3s ease'; t.style.opacity = '0'; setTimeout(() => t.remove(), 350); }, 2600);
    }

    function setTheme(name) {
      document.body.classList.remove('theme-light', 'theme-green', 'theme-purple');
      if (name === 'light') document.body.classList.add('theme-light');
      if (name === 'green') document.body.classList.add('theme-green');
      if (name === 'purple') document.body.classList.add('theme-purple');
      state.theme = name; saveState();
      const ts = document.getElementById('themeSelect'); if (ts) ts.value = name === 'default' ? 'default' : name;
      const ts2 = document.getElementById('themeSelect2'); if (ts2) ts2.value = name === 'default' ? 'default' : name;
    }

    // ====== CARD UTILS ======
    const computeCardNumberFromId = (id) => {
      const clean = String(id).replace(/\D/g,'').padStart(6,'0').slice(-6);
      // 5282  34** **  3456 ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏—Ä–º–µ–Ω–Ω—ã–µ –∫—Ä–∞—è, —Å–µ—Ä–µ–¥–∏–Ω–∞ –æ—Ç ID
      return `5282  34${clean.slice(0,2)}  ${clean.slice(2,4)}${clean.slice(4,6)}  3456`;
    };
    const computeValidThru = () => {
      const now = new Date(); const mm = String(now.getMonth()+1).padStart(2,'0'); const yy = String((now.getFullYear()+4)%100).padStart(2,'0');
      return `${mm}/${yy}`;
    };

    // ====== RENDER ======
    function renderSummary(){
      document.getElementById('balanceView').textContent = fmtMoney(state.balance);
      document.getElementById('pointsView').textContent = state.points;
      const pv2 = document.getElementById('pointsView2'); if (pv2) pv2.textContent = state.points;
      document.getElementById('cardOwner').textContent = state.user.name || 'Neo User';
      const cn = state.user.id ? computeCardNumberFromId(state.user.id) : '5282  3421  9012  3456';
      document.getElementById('cardNumber').textContent = cn;
      const vt = state.validThru || computeValidThru();
      document.getElementById('validThru').textContent = 'VALID THRU ' + vt;
    }

    function renderHistory(){
      const tbody = document.getElementById('historyBody');
      if (!tbody) return;
      tbody.innerHTML = '';
      [...state.history].reverse().slice(0, 50).forEach(item => {
        const tr = document.createElement('tr');
        const sumSign = (item.type === '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' || item.type === '–û–±–º–µ–Ω –±–∞–ª–ª–æ–≤‚Üí‚ÇΩ') ? '+' : (item.amount > 0 ? '-' : '');
        tr.innerHTML = `<td>${fmtDate(item.date)}</td><td>${item.type}</td><td>${sumSign}${fmtMoney(Math.abs(item.amount))}</td><td>${item.points > 0 ? '+'+item.points : item.points}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderShop(){
      const draw = (gridId) => {
        const grid = document.getElementById(gridId);
        if (!grid) return;
        grid.innerHTML = '';
        state.shop.forEach(prod => {
          const el = document.createElement('div');
          el.className = 'product';
          el.innerHTML = `
            <div class="thumb">${prod.emoji}</div>
            <div class="title" style="font-weight:700">${prod.title}</div>
            <div class="meta"><span style="color:var(--muted)">${prod.cost} –±–∞–ª–ª–æ–≤</span>
              <button class="btn btn-primary" data-buy="${prod.id}">–ü–æ–ª—É—á–∏—Ç—å</button>
            </div>`;
          grid.appendChild(el);
        });
      };
      draw('shopGrid');
      draw('shopGridModal');
    }

    function renderProfile(){
      const name = document.getElementById('userName'); if (name) name.value = state.user.name || '';
      const id = document.getElementById('userId'); if (id) id.value = state.user.id || '';
      const city = document.getElementById('userCity'); if (city) city.value = state.user.city || '';
      const theme2 = document.getElementById('themeSelect2'); if (theme2) theme2.value = state.theme || 'default';
    }

    // ====== ROUTER ======
    const routes = ['pay','points','topup','history','shop','profile'];
    function showPage(name){
      routes.forEach(r => document.getElementById('page-'+r)?.classList.remove('active'));
      const el = document.getElementById('page-'+name);
      if (el) el.classList.add('active');
      const firstInput = el ? el.querySelector('input') : null; if (firstInput) firstInput.focus();
      renderSummary(); if(name==='history') renderHistory(); if(name==='shop') renderShop(); if(name==='profile') renderProfile();
      window.location.hash = '#'+name;
    }

    // ====== ACTIONS ======
    function addHistory(rec){ state.history.push(rec); saveState(); }

    function pay(amount){
      if (amount <= 0) return toast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ –Ω—É–ª—è', 'warn');
      if (amount > state.balance) return toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'err');
      state.balance -= amount;
      const gained = Math.floor(amount * 0.05);
      state.points += gained;
      addHistory({ type: '–û–ø–ª–∞—Ç–∞', amount, points: gained, date: new Date().toISOString() });
      saveState(); renderSummary(); renderHistory();
      toast('–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞'); if (gained>0) toast('–ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã: +' + gained);
    }

    function topup(amount){
      if (amount <= 0) return toast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ –Ω—É–ª—è', 'warn');
      state.balance += amount;
      addHistory({ type: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', amount, points: 0, date: new Date().toISOString() });
      saveState(); renderSummary(); renderHistory();
      toast('–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω');
    }

    function exchangePoints(p){
      if (p <= 0) return toast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ –±–∞–ª–ª–æ–≤', 'warn');
      if (p > state.points) return toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤', 'err');
      state.points -= p; state.balance += p;
      addHistory({ type: '–û–±–º–µ–Ω –±–∞–ª–ª–æ–≤‚Üí‚ÇΩ', amount: p, points: -p, date: new Date().toISOString() });
      saveState(); renderSummary(); renderHistory();
      toast('–û–±–º–µ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω');
    }

    function buyProduct(id){
      const prod = state.shop.find(x => x.id === id); if (!prod) return;
      if (state.points < prod.cost) return toast('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –±–∞–ª–ª–æ–≤', 'err');
      state.points -= prod.cost;
      addHistory({ type: `–ú–∞–≥–∞–∑–∏–Ω: ${prod.title}`, amount: 0, points: -prod.cost, date: new Date().toISOString() });
      saveState(); renderSummary(); renderHistory();
      toast(`–ü–æ–ª—É—á–µ–Ω–æ: ${prod.title}`);
    }

    // ====== SHOP MODAL ======
    function openShop(){
      renderShop();
      document.getElementById('shopModal').classList.add('show');
      document.getElementById('shopModal').setAttribute('aria-hidden','false');
    }
    function closeShop(){
      document.getElementById('shopModal').classList.remove('show');
      document.getElementById('shopModal').setAttribute('aria-hidden','true');
    }

    // ====== ONBOARDING ======
    const needsOnboarding = () => !state.user || !state.user.email || !state.user.phone || !state.user.name;
    const openOnboarding = () => {
      const ob = document.getElementById('onboarding'); ob.classList.add('show'); ob.setAttribute('aria-hidden','false');
      setTimeout(() => document.getElementById('fullName')?.focus(), 50);
    };
    const closeOnboarding = () => {
      const ob = document.getElementById('onboarding'); ob.classList.remove('show'); ob.setAttribute('aria-hidden','true');
    };

    function generateUserId(){
      const rnd = Math.floor(100000 + Math.random()*900000); // 6 —Ü–∏—Ñ—Ä
      return String(rnd);
    }

    // ====== PAGE OVERLAY (–¥–ª—è Pay/Points/Topup/History/Profile) ======
    const overlayRoutes = ['pay','points','topup','history','profile'];
    const pageOverlay = document.getElementById('pageOverlay');
    const overlayBody = document.getElementById('overlayBody');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayClose = document.getElementById('overlayClose');
    const originalParents = {}; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const originalActiveStates = {};

    function openPageOverlay(route){
      const pageId = 'page-' + route;
      const pageEl = document.getElementById(pageId);
      if (!pageEl) return;
      // –∑–∞–ø–æ–º–Ω–∏–º —Ä–æ–¥–∏—Ç–µ–ª—è –∏ active —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
      if (!originalParents[pageId]) {
        originalParents[pageId] = pageEl.parentElement;
        originalActiveStates[pageId] = pageEl.classList.contains('active');
      }
      // –æ—á–∏—Å—Ç–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–º–µ—Å—Ç–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω—É—Ç—Ä—å –æ–≤–µ—Ä–ª–µ—è (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –Ω–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
      overlayBody.innerHTML = '';
      overlayBody.appendChild(pageEl);
      // –ø–æ–º–µ—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–π (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
      pageEl.classList.add('active');
      pageOverlay.classList.add('show');
      pageOverlay.setAttribute('aria-hidden','false');

      // –∑–∞–≥–æ–ª–æ–≤–æ–∫
      const titles = { pay: '–û–ø–ª–∞—Ç–∞', points: '–ë–∞–ª–ª—ã', topup: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', history: '–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π', profile: '–ü—Ä–æ—Ñ–∏–ª—å' };
      overlayTitle.textContent = titles[route] || '';

      // —Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
      setTimeout(() => { const fi = pageEl.querySelector('input,button,select'); if (fi) fi.focus(); }, 40);

      // –µ—Å–ª–∏ —ç—Ç–æ Pay ‚Äî –ø—Ä–∏–≤—è–∂–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é QR (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
      if (route === 'pay') attachPayQR(pageEl);
      // –µ—Å–ª–∏ history ‚Äî –æ–±–Ω–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ
      if (route === 'history') renderHistory();
      if (route === 'shop') renderShop();
    }

    function closePageOverlay(){
      // –ø–µ—Ä–µ–º–µ—Å—Ç–∏–º –≤—Å—ë –∏–∑ overlayBody –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø—Ä–µ–∂–Ω–∏–µ –º–µ—Å—Ç–∞
      Array.from(overlayBody.children).forEach(child => {
        const id = child.id;
        if (originalParents[id]) {
          // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ active
          if (!originalActiveStates[id]) child.classList.remove('active');
          originalParents[id].appendChild(child);
        } else {
          // –Ω–∞ –∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π –≤–µ—Ä–Ω—ë–º –≤ app
          document.getElementById('app').appendChild(child);
        }
      });
      overlayBody.innerHTML = '';
      pageOverlay.classList.remove('show');
      pageOverlay.setAttribute('aria-hidden','true');
    }

    overlayClose.addEventListener('click', closePageOverlay);
    pageOverlay.addEventListener('click', (e) => { if (e.target === pageOverlay) closePageOverlay(); });

    // ====== EVENTS ======
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è: –º–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–∞–∫ —Ä–∞–Ω—å—à–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –≤ –æ–≤–µ—Ä–ª–µ—è—Ö
    document.querySelectorAll('[data-route]').forEach(el => el.addEventListener('click', () => {
      const route = el.dataset.route;
      if (route === 'shop') { openShop(); }
      else if (overlayRoutes.includes(route)) { openPageOverlay(route); }
      else { showPage(route); }
    }));

    // –ü–æ–∫—É–ø–∫–∏ –∏–∑ –æ–±–æ–∏—Ö –≥—Ä–∏–¥–æ–≤ + –∑–∞–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-buy]');
      if (btn) buyProduct(btn.dataset.buy);
      if (e.target.matches('[data-close-shop]')) closeShop();
    });

    // Pay form (–æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö)
    document.getElementById('payForm').addEventListener('submit', e => {
      e.preventDefault();
      const v = Math.floor(Number(document.getElementById('payAmount').value));
      pay(v); e.target.reset();
    });

    document.getElementById('topupForm').addEventListener('submit', e => {
      e.preventDefault();
      const v = Math.floor(Number(document.getElementById('topupAmount').value));
      topup(v); e.target.reset();
    });

    document.getElementById('exchangeForm').addEventListener('submit', e => {
      e.preventDefault();
      const v = Math.floor(Number(document.getElementById('exchangeAmount').value));
      exchangePoints(v); e.target.reset();
    });
    document.getElementById('exchangeAll').addEventListener('click', () => { if (state.points > 0) exchangePoints(state.points); });

    document.getElementById('profileForm').addEventListener('submit', e => {
      e.preventDefault();
      state.user.name = document.getElementById('userName').value || 'Neo User';
      state.user.id = document.getElementById('userId').value || state.user.id || generateUserId();
      state.user.city = document.getElementById('userCity').value || '';
      setTheme(document.getElementById('themeSelect2').value || 'default');
      saveState(); renderSummary();
      toast('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
    });

    document.getElementById('themeSelect').addEventListener('change', e => setTheme(e.target.value));
    document.getElementById('themeSelect2').addEventListener('change', e => setTheme(e.target.value));

    // –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å–∞–±–º–∏—Ç
    document.getElementById('onboardForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const city = document.getElementById('city').value.trim();
      if (!name || !email || !phone) { return toast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'warn'); }
      state.user.name = name; state.user.email = email; state.user.phone = phone; state.user.city = city;
      state.user.id = generateUserId();
      state.validThru = computeValidThru();
      saveState(); renderSummary(); renderProfile();
      closeOnboarding();
      toast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
      toast('–í–∞—à ID: ' + state.user.id);
      toast('–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø—Ä–∏—Å–≤–æ–µ–Ω');
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–≤–µ—Ä–ª–µ–µ–≤ –ø–æ Esc/–∫–ª–∏–∫—É –ø–æ —Ñ–æ–Ω—É
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –∏/–∏–ª–∏ pageOverlay
        closeShop();
        if (pageOverlay.classList.contains('show')) closePageOverlay();
      }
    });
    document.getElementById('shopModal').addEventListener('click', (e) => { if (e.target.id === 'shopModal') closeShop(); });

    // ====== QR –≤ Pay: –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∏ canvas (–ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ) ======
    function attachPayQR(pageEl) {
      // –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ —ç—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç page-pay (–ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è, –Ω–µ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è)
      const form = pageEl.querySelector('#payForm');
      if (!form) return;
      // –µ—Å–ª–∏ —É–∂–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ ‚Äî –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º
      if (form.querySelector('.pay-qr-controls')) return;

      const controls = document.createElement('div');
      controls.className = 'pay-qr-controls';
      controls.style.marginTop = '12px';

      const btnQR = document.createElement('button');
      btnQR.type = 'button';
      btnQR.className = 'btn btn-ghost';
      btnQR.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR';

      const canvas = document.createElement('canvas');
      canvas.id = 'payQRCanvas';
      canvas.width = 220;
      canvas.height = 220;
      canvas.style.display = 'none';
      canvas.style.marginTop = '12px';
      canvas.style.borderRadius = '8px';
      canvas.style.background = 'white';

      controls.appendChild(btnQR);
      controls.appendChild(canvas);
      form.appendChild(controls);

      btnQR.addEventListener('click', () => {
        const amount = form.querySelector('#payAmount').value || '0';
        const qrValue = `NeoBank Payment;amount=${amount}`;
        try {
          // QRious —Ä–∏—Å—É–µ—Ç –Ω–∞ canvas
          new QRious({ element: canvas, value: qrValue, size: 220 });
          canvas.style.display = 'block';
        } catch (err) {
          // fallback: –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç
          canvas.style.display = 'block';
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0,0,canvas.width,canvas.height);
          ctx.fillStyle = '#000';
          ctx.fillText(qrValue, 10, 20);
        }
      });
    }

    /* ======================= –î–û–ë–ê–í–õ–ï–ù–û: JS –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ ======================= */
    // NEW: —Ñ—É–Ω–∫—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–π –∫—Ä–∞—Å–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –±–ª–æ–∫–∞ –±–∞–ª–∞–Ω—Å–∞; –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function flashBalanceDebit(){
      const el = document.getElementById('balanceView');
      if (!el) return;
      el.classList.remove('balance-flash-red'); // —Å–±—Ä–æ—Å, —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å
      void el.offsetWidth;                      // –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Ñ–ª–æ—É
      el.classList.add('balance-flash-red');    // –∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ 1.2s
    }

    // NEW: –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π pay(), —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏
    (function(){
      const originalPay = pay;
      window.pay = function(amount){
        const before = state.balance;
        originalPay(amount);                    // –≤—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        if (amount > 0 && state.balance < before) {
          flashBalanceDebit();                  // –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∏–ª—Å—è ‚Äî –º–∏–≥–Ω—ë–º –∫—Ä–∞—Å–Ω—ã–º
        }
      };
    })();
    /* ======================= /–î–û–ë–ê–í–õ–ï–ù–û ======================= */

    // ====== INIT ======
    (function init(){
      // –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –±—ã–ª–∏ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ email/phone, –ø–æ–ø—Ä–æ—Å–∏–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (—Ä–∞–∑–æ–≤–æ)
      setTheme(state.theme || 'default');
      renderSummary(); renderShop(); renderHistory(); renderProfile();
      const initialRoute = (location.hash || '').replace('#','');
      // –°–æ—Ö—Ä–∞–Ω–∏–º –ø—Ä–µ–∂–Ω–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –µ—Å–ª–∏ –≤ URL –µ—Å—Ç—å —Ö–µ—à ‚Äî –æ—Ç–∫—Ä–æ–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º
      if (initialRoute && overlayRoutes.includes(initialRoute)) {
        // –µ—Å–ª–∏ —Ö–µ—à —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∏–∑ overlayRoutes ‚Äî –æ—Ç–∫—Ä–æ–µ–º –µ–≥–æ –∫–∞–∫ overlay
        openPageOverlay(initialRoute);
      } else if (initialRoute && routes.includes(initialRoute)) {
        // –∏–Ω–∞—á–µ ‚Äî –ø–æ–∫–∞–∂–µ–º –∫–∞–∫ —Ä–∞–Ω—å—à–µ (inline)
        showPage(initialRoute);
      } else {
        // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ–∫–∞–∑–∞—Ç—å PAY –∫–∞–∫ —Ä–∞–Ω—å—à–µ (—á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
        showPage('pay');
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      if (needsOnboarding()) openOnboarding();
    })();
  </script>
</body>
</html>
```
