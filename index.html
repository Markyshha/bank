```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NeoBank Lite v3</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; color:#000; margin:0; padding:0; }
    header { background:#fff; border-bottom:1px solid #ddd; padding:12px 16px; }
    h1 { margin:0; font-size:22px; }
    #message { background:#eef; padding:10px; margin:10px; border:1px solid #ccd; border-radius:8px; }
    nav { display:flex; flex-wrap:wrap; gap:8px; padding:10px; background:#fff; border-bottom:1px solid #ddd; }
    nav button { flex:1; min-width:100px; padding:10px; border:1px solid #ccc; border-radius:10px; background:#fff; cursor:pointer; font-weight:600; }
    nav button:hover { background:#f0f0f0; }
    .container { padding:16px; }
    .page { display:none; }
    .active { display:block; }
    .card { background:#fff; border:1px solid #ddd; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 2px 4px rgba(0,0,0,.05); }
    input { width:100%; padding:10px; margin:6px 0; border:1px solid #ccc; border-radius:8px; }
    button { padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:#fff; cursor:pointer; font-weight:600; }
    button:hover { background:#f0f0f0; }
    table { border-collapse:collapse; width:100%; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:6px; text-align:left; font-size:14px; }
    .stat { padding:10px; border:1px solid #ddd; border-radius:8px; margin:6px 0; background:#fff; }
  </style>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <header>
    <h1>NeoBank Lite</h1>
    <div>Баланс: <span id="balanceView">0</span> ₽ | Баллы: <span id="pointsView">0</span></div>
  </header>

  <div id="message">Необходимо зарегистрироваться</div>

  <nav id="mainNav" style="display:none;">
    <button onclick="showPage('pay')">Оплата</button>
    <button onclick="showPage('topup')">Пополнение</button>
    <button onclick="showPage('points')">Баллы</button>
    <button onclick="showPage('history')">История</button>
    <button onclick="showPage('shop')">Магазин</button>
    <button onclick="showPage('qr')">QR Оплата</button>
    <button onclick="showPage('profile')">Профиль</button>
  </nav>

  <div class="container">
    <section id="page-register" class="page active">
      <div class="card">
        <h2>Регистрация</h2>
        <form id="registerForm">
          <input id="fullName" placeholder="ФИО" required>
          <input id="email" type="email" placeholder="Email" required>
          <input id="phone" type="tel" placeholder="Телефон" required>
          <input id="city" placeholder="Город">
          <button type="submit">Зарегистрироваться</button>
        </form>
      </div>
    </section>

    <section id="page-pay" class="page">
      <div class="card">
        <h2>Оплата</h2>
        <form id="payForm">
          <input id="payAmount" type="number" min="1" placeholder="Сумма ₽" required>
          <button type="submit">Оплатить</button>
        </form>
      </div>
    </section>

    <section id="page-topup" class="page">
      <div class="card">
        <h2>Пополнение</h2>
        <form id="topupForm">
          <input id="topupAmount" type="number" min="1" placeholder="Сумма ₽" required>
          <button type="submit">Пополнить</button>
        </form>
      </div>
    </section>

    <section id="page-points" class="page">
      <div class="card">
        <h2>Баллы</h2>
        <div>Текущие баллы: <span id="pointsView2">0</span></div>
        <form id="exchangeForm">
          <input id="exchangeAmount" type="number" min="1" placeholder="Сколько обменять">
          <button type="submit">Обменять</button>
          <button type="button" onclick="exchangeAll()">Обменять всё</button>
        </form>
      </div>
    </section>

    <section id="page-history" class="page">
      <div class="card">
        <h2>История</h2>
        <table>
          <thead><tr><th>Дата</th><th>Операция</th><th>Сумма</th><th>Баллы</th></tr></thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>

    <section id="page-shop" class="page">
      <div class="card">
        <h2>Магазин</h2>
        <div id="shopList"></div>
      </div>
    </section>

    <section id="page-qr" class="page">
      <div class="card">
        <h2>QR Оплата</h2>
        <div id="qrCameraBlock">
          <div id="reader" style="width:300px; margin:auto;"></div>
          <button type="button" onclick="startQR()">Сканировать QR</button>
          <div id="qrResult" style="margin-top:10px; font-weight:600;"></div>
        </div>
        <div id="qrManualBlock" style="margin-top:20px;">
          <form id="qrForm">
            <input id="qrValue" placeholder="Вставьте QR-данные (например: чипсы_лэйс:alert:150)">
            <button type="submit">Оплатить QR</button>
          </form>
        </div>
      </div>
    </section>

    <section id="page-profile" class="page">
      <div class="card">
        <h2>Профиль</h2>
        <form id="profileForm">
          <input id="userName" placeholder="Имя">
          <input id="userId" placeholder="ID">
          <input id="userCity" placeholder="Город">
          <button type="submit">Сохранить</button>
        </form>
      </div>
    </section>
  </div>

  <script>
    var STORAGE_KEY = "neobank_lite_v3";
    var state = {
      user: { name:"", id:"", city:"", email:"", phone:"" },
      balance: 1000,
      points: 200,
      history: [],
      shop: [
        { id:"s1", title:"Стикеры", cost:100 },
        { id:"s2", title:"Кофе", cost:150 },
        { id:"s3", title:"Месяц музыки", cost:500 }
      ]
    };
    try {
      var saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
      if(saved) state = saved;
    } catch(e){}

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function msg(t){ document.getElementById("message").innerHTML = t; }

    function showPage(name){
      var pages = document.getElementsByClassName("page");
      for(var i=0;i<pages.length;i++){ pages[i].className="page"; }
      var el = document.getElementById("page-"+name);
      if(el) el.className="page active";
      render();
    }

    function render(){
      document.getElementById("balanceView").innerHTML = state.balance;
      document.getElementById("pointsView").innerHTML = state.points;
      var pv2 = document.getElementById("pointsView2"); if(pv2) pv2.innerHTML = state.points;
      var hb = document.getElementById("historyBody"); if(hb){
        hb.innerHTML="";
        for(var i=state.history.length-1;i>=0;i--){
          var h=state.history[i];
          var tr=document.createElement("tr");
          tr.innerHTML="<td>"+h.date+"</td><td>"+h.type+"</td><td>"+h.amount+"</td><td>"+h.points+"</td>";
          hb.appendChild(tr);
        }
      }
      var shop=document.getElementById("shopList"); if(shop){
        shop.innerHTML="";
        for(var i=0;i<state.shop.length;i++){
          var p=state.shop[i];
          var div=document.createElement("div");
          div.className="stat";
          div.innerHTML=p.title+" — "+p.cost+" баллов <button onclick=\"buy('"+p.id+"')\">Купить</button>";
          shop.appendChild(div);
        }
      }
    }

    function addHistory(t,a,p){
      state.history.push({type:t,amount:a,points:p,date:new Date().toLocaleString()});
      save();
    }

    function pay(amount){
      if(amount<=0){ msg("Введите сумму >0"); return; }
      if(amount>state.balance){ msg("Недостаточно средств"); return; }
      state.balance-=amount;
      var gained=Math.floor(amount*0.05);
      state.points+=gained;
      addHistory("Оплата",-amount,gained);
      save(); render(); msg("Оплата успешна, начислено "+gained+" баллов");
    }

    function topup(amount){
      if(amount<=0){ msg("Введите сумму >0"); return; }
      state.balance+=amount;
      addHistory("Пополнение",amount,0);
      save(); render(); msg("Пополнение успешно");
    }

    function exchange(p){
      if(p<=0){ msg("Введите >0"); return; }
      if(p>state.points){ msg("Недостаточно баллов"); return; }
      state.points-=p; state.balance+=p;
      addHistory("Обмен баллов",p,-p);
      save(); render(); msg("Обмен успешен");
    }
    function exchangeAll(){ if(state.points>0) exchange(state.points); }

    function buy(id){
      for(var i=0;i<state.shop.length;i++){
        var prod=state.shop[i];
        if(prod.id===id){
          if(state.points<prod.cost){ msg("Недостаточно баллов"); return; }
          state.points-=prod.cost;
          addHistory("Покупка: "+prod.title,0,-prod.cost);
          save(); render(); msg("Получено: "+prod.title);
          return;
        }
      }
    }

    function payQR(value){
      if(!value){ msg("Введите данные QR"); return; }
      var parts=value.split(":");
      if(parts.length<3){ msg("Неверный формат QR"); return; }
      var product=parts[0];
      var price=parseInt(parts[2],10);
      if(isNaN(price)||price<=0){ msg("Неверная цена"); return; }
      if(price>state.balance){ msg("Недостаточно средств для QR оплаты"); return; }
      state.balance-=price;
      addHistory("QR Оплата — "+product,-price,0);
      save(); render(); msg("QR оплата успешна: "+product+" за "+price+"₽");
    }

    document.getElementById("registerForm").onsubmit=function(e){
      e.preventDefault();
      state.user.name=document.getElementById("fullName").value;
      state.user.email=document.getElementById("email").value;
      state.user.phone=document.getElementById("phone").value;
      state.user.city=document.getElementById("city").value;
      state.user.id=String(Math.floor(100000+Math.random()*900000));
      save(); render(); msg("Регистрация успешна, ID: "+state.user.id);
      document.getElementById("mainNav").style.display="flex";
      showPage("pay");
    };

    document.getElementById("payForm").onsubmit=function(e){
      e.preventDefault();
      var v=parseInt(document.getElementById("payAmount").value,10);
      pay(v);
      this.reset();
    };

    document.getElementById("topupForm").onsubmit=function(e){
      e.preventDefault();
      var v=parseInt(document.getElementById("topupAmount").value,10);
      topup(v);
      this.reset();
    };

    document.getElementById("exchangeForm").onsubmit=function(e){
      e.preventDefault();
      var v=parseInt(document.getElementById("exchangeAmount").value,10);
      exchange(v);
      this.reset();
    };

    document.getElementById("profileForm").onsubmit=function(e){
      e.preventDefault();
      state.user.name=document.getElementById("userName").value;
      state.user.id=document.getElementById("userId").value||state.user.id;
      state.user.city=document.getElementById("userCity").value;
      save(); render(); msg("Профиль сохранён");
    };

    document.getElementById("qrForm").onsubmit=function(e){
      e.preventDefault();
      var v=document.getElementById("qrValue").value.trim();
      payQR(v);
      this.reset();
    };

    if(state.user && state.user.id){
      document.getElementById("mainNav").style.display="flex";
      msg("Добро пожаловать, "+state.user.name);
      showPage("pay");
    }
    render();
  </script>

  <script>
    var qrScanner;
    function startQR(){
      msg("Включена камера для сканирования...");
      if(!qrScanner){
        qrScanner = new Html5Qrcode("reader");
      }
      qrScanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrSuccess,
        qrError
      );
    }

    function qrSuccess(decodedText, decodedResult){
      document.getElementById("qrResult").innerHTML = "QR: "+decodedText;
      qrScanner.stop();
      payQR(decodedText);
    }

    function qrError(errorMessage){
      console.log("QR error:", errorMessage);
    }

    if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){
      document.getElementById("qrCameraBlock").style.display="none";
    }
  </script>
</body>
</html>
```
